%turbo-frame{ id: "modal-commentaire-batch-form" }
  = render Dsfr::NoticeComponent.new(data_attributes: { class: 'fr-mb-2w' }) do |c|
    - c.with_title do
      = t('.notice')
  .fr-highlight
    %p.fr-text--sm
      %strong
        = t('asterisk_html', scope: [:utils])

  = render NestedForms::FormOwnerComponent.new

  - form_data = { controller: 'persisted-form', persisted_form_key_value: 'create_commentaire_form', remote: true, 'batch-operation-target': 'commentaireForm'}

  = form_for commentaire, url: url, html: { multipart: true, data: form_data } do |f|
    .fr-input-group
      = render Dsfr::InputComponent.new(form: f, attribute: :body, input_type: :text_area)

    .fr-input-group
      = f.label :piece_jointe, class: 'fr-label'
      = render Attachment::EditComponent.new(attached_file: commentaire.piece_jointe)

    - if dossier_ids.present?
      - dossier_ids.each do |id|
        = hidden_field_tag 'batch_operation[dossier_ids][]', id

    = hidden_field_tag 'batch_operation[statut]', params[:statut]

    %ul.fr-btns-group.fr-btns-group--inline-md
      %li
        %button.fr-btn.fr-btn--secondary{ aria: { controls: 'modal-commentaire-batch' }, "data-fr-js-modal-button" => "true" }
          = t('.cancel')
      %li.split-button-wrapper
        = button_tag t('.submit'), type: 'submit', class: 'fr-btn fr-mr-0', data: { disable: true }, name: 'mark_as_pending_response', value: 'false'
        = render Dropdown::MenuComponent.new(wrapper: :div, button_options: { class: "fr-ml-0 split-button-toggle" }, menu_options: { class: "split-button-dropdown fr-mb-1v" }) do |menu|
          - menu.with_item(class: "fr-px-0 fr-py-0") do
            = button_tag type: 'submit', class: 'fr-btn fr-btn--tertiary-no-outline fr-mx-0 fr-my-0 fr-py-1w', data: { disable: true }, name: 'mark_as_pending_response', value: 'true' do
              = t('.send_message_and_mark')
              %span.fr-badge.fr-badge--sm.fr-ml-1w= t('.pending_response_badge')
